# 每日更新流程 - 完整数据流

## 📊 数据流程图

```
┌─────────────────────────────────────────────────────────────────┐
│  步骤 1: 爬取全平台价格                                          │
│  fetch_prices_with_steamdt.py                                   │
│  --platform all --min-only                                      │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
        ┌──────────────────────────────┐
        │   SteamDT API (9个平台)       │
        │  ✓ STEAM   ✓ BUFF   ✓ YOUPIN │
        │  ✓ C5      ✓ WAXPEER          │
        │  ✓ DMARKET ✓ CSMONEY          │
        │  ✓ SKINPORT ✓ HALOSKINS       │
        └──────────────┬───────────────┘
                       │ 自动选择每个商品的最低价
                       ▼
        ┌──────────────────────────────┐
        │   prices_all_min.csv          │
        │  ┌────────────────────────┐   │
        │  │ AK-47 Elite Build (FN) │   │
        │  │ Price: 61.39           │   │
        │  │ Platform: BUFF ✅      │   │
        │  └────────────────────────┘   │
        └──────────────┬───────────────┘
                       │
┌──────────────────────┴──────────────────────────────────────────┐
│  步骤 2: 统一价格格式                                            │
│  unify_prices.py                                                │
│  - 提取外观信息 (FN/MW/FT/WW/BS)                                │
│  - 保留平台来源                                                  │
│  - 关联系列和稀有度                                              │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
        ┌──────────────────────────────┐
        │  prices_with_exterior.csv     │
        │  ┌────────────────────────┐   │
        │  │ name: AK-47 Elite Build│   │
        │  │ exterior: FN           │   │
        │  │ price: 61.39           │   │
        │  │ platform: BUFF ✅      │   │
        │  │ series: Chroma 2 Case  │   │
        │  │ tier: Mil-Spec         │   │
        │  └────────────────────────┘   │
        └──────────────┬───────────────┘
                       │
┌──────────────────────┴──────────────────────────────────────────┐
│  步骤 3: 科学版计算                                              │
│  calculate_scientific.py                                        │
│  + skins_meta_complete.csv (浮漂范围)                           │
│  - 计算期望产出价值                                              │
│  - 考虑磨损传导                                                  │
│  - 计算利润和ROI                                                 │
└──────────────────────┬──────────────────────────────────────────┘
                       │
                       ▼
        ┌──────────────────────────────┐
        │   最终输出文件                 │
        │  ┌────────────────────────┐   │
        │  │ 科学版_盈利TOP100.csv   │   │
        │  │  - 完整计算数据         │   │
        │  │  - 包含平台来源 ✅     │   │
        │  └────────────────────────┘   │
        │  ┌────────────────────────┐   │
        │  │ 按ROI排序.txt           │   │
        │  │  - 最高收益率方案       │   │
        │  └────────────────────────┘   │
        │  ┌────────────────────────┐   │
        │  │ 按利润排序.txt          │   │
        │  │  - 最高利润方案         │   │
        │  └────────────────────────┘   │
        └───────────────────────────────┘
```

---

## ✅ 您的理解完全正确！

### 完整流程：

1. **爬取全平台价格** 📡
   - `fetch_prices_with_steamdt.py` 使用 `--platform all --min-only`
   - 自动从 9 个平台获取价格
   - **自动选择每个商品的最低价**
   - 输出到 `prices_all_min.csv`（包含平台来源：BUFF、YOUPIN、C5等）

2. **统一格式** 🔧
   - `unify_prices.py` 处理价格数据
   - 提取外观信息
   - **保留平台来源**
   - 输出到 `prices_with_exterior.csv`

3. **科学计算** 🧮
   - `calculate_scientific.py` 读取 `prices_with_exterior.csv`
   - **使用全平台最低价**计算期望产出
   - 考虑磨损传导和浮漂范围
   - 输出最优 Trade-Up 方案

---

## 💰 关键优势

### 之前（只用 Steam）：
- AK-47 Elite Build (FN) 成本：¥90.42
- MP7 Armor Core (FN) 成本：¥5.26

### 现在（全平台最低价）：
- AK-47 Elite Build (FN) 成本：¥61.39 (BUFF) ✅ **省32%**
- MP7 Armor Core (FN) 成本：¥3.35 (BUFF) ✅ **省36%**

**结果：** 使用全平台最低价，您的 Trade-Up 方案：
- ✅ 成本更低（平均省30-36%）
- ✅ 利润更高
- ✅ ROI更大
- ✅ 可追溯每个价格来源平台

---

## 📋 实际运行时的输出

运行 `每日更新.bat` 时，您会看到：

```
[步骤 1/3] 爬取最新价格数据（全平台最低价）...
  → 从 STEAM/BUFF/YOUPIN/C5 等9个平台自动选择最低价
开始获取 2379 个物品的价格...
获取价格: 100%|██████████| 2379/2379

✅ 完成! 已保存 XXXX 条记录到 prices_all_min.csv

================================================================================
📊 价格数据统计
================================================================================
总计获取 XXXX 条有效价格记录：
--------------------------------------------------------------------------------
  BUFF       : XXXX 条  (45.2%)  ████████████████████████
  C5         :  XXX 条  (15.1%)  ███████
  YOUPIN     :  XXX 条  (12.3%)  ██████
  STEAM      :  XXX 条  (20.4%)  ██████████
  ...
--------------------------------------------------------------------------------
💰 价格对比分析（基准：STEAM）：
--------------------------------------------------------------------------------
  ✅ BUFF    : 平均  +34.2%  (累计省 ¥12345.67, 1234个商品)
  ✅ C5      : 平均  +30.3%  (累计省 ¥8901.23, 456个商品)
  ...
================================================================================

[步骤 2/3] 统一价格格式...
  → 处理外观信息并保留平台来源
✅ 格式统一完成

[步骤 3/3] 运行科学版计算...
  → 基于全平台最低价计算最优 Trade-Up 方案
已导出 CSV：科学版_盈利TOP100.csv
所有文件生成完成！

💰 提示: 所有价格均为全平台最低价（BUFF/YOUPIN/C5/STEAM等）
```

---

## 🎯 总结

您的理解 **100% 正确**！

✅ 每日运行 `每日更新.bat`  
✅ 自动爬取 SteamDT 的 9 个平台价格  
✅ 自动选择每个商品的最低价  
✅ 输出到 `prices_all_min.csv`（包含 BUFF、YOUPIN、C5 等平台）  
✅ 科学计算调用这些最低价  
✅ 输出基于全网最低价的最优方案  

现在就可以运行 `每日更新.bat` 体验了！🚀
